# 学校社团管理平台后端系统 - 概要设计文档

## 1. 项目概述

### 1.1 项目背景
学校社团管理平台是一个面向高校的综合性社团管理系统，旨在实现社团活动的数字化管理，提升社团运营效率，促进学生参与社团活动的积极性。

### 1.2 项目目标
- 实现学生、社团管理员、学校管理员三端协同管理
- 提供社团活动全生命周期管理功能
- 建立积分激励机制，鼓励学生参与活动
- 提供数据统计分析功能，辅助决策

### 1.3 技术栈
- **后端框架**: Spring Boot 3.3.5
- **编程语言**: Java 21
- **数据库**: MySQL
- **ORM框架**: Spring Data JPA
- **安全认证**: Spring Security + JWT
- **构建工具**: Maven
- **其他工具**: Lombok, Apache Commons Lang3

---

## 2. 系统架构设计

### 2.1 整体架构

```
┌────────────────────────────────────────────────────────────────┐
│                         前端应用层                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                      │
│  │ 学生端    │  │社团管理员  │  │学校管理员 │                      │
│  │  (C端)   │  │  (B端)    │  │  (B端)   │                      │
│  └──────────┘  └──────────┘  └──────────┘                      │
└────────────────────────────────────────────────────────────────┘
                              ↓ HTTPS
┌─────────────────────────────────────────────────────────────────┐
│                      API网关 / 负载均衡                           │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌────────────────────────────────────────────────────────────────┐
│                    Spring Boot 应用层                           │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Controller层                         │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐     │   │
│  │  │AuthCtrl │  │UserCtrl │  │ClubAdmin│  │School   │     │   │
│  │  │         │  │         │  │Ctrl     │  │AdminCtrl│     │   │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Service层                            │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐     │   │
│  │  │Auth     │  │Activity │  │ClubMgmt │  │Statistics│    │   │
│  │  │Service  │  │Service  │  │Service  │  │Service   │    │   │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Repository层                         │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐     │   │
│  │  │Student  │  │ClubRepo │  │Activity │  │Approval │     │   │
│  │  │Repo     │  │         │  │Repo     │  │Repo     │     │   │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                    Entity层 (JPA)                        │   │
│  │  Student, Club, Activity, ClubMember, ...                │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌────────────────────────────────────────────────────────────────┐
│                       MySQL 数据库                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐        │
│  │学生表     │  │社团表     │  │活动表     │  │申请表     │        │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘        │
└────────────────────────────────────────────────────────────────┘
```

### 2.2 分层架构说明

#### 2.2.1 Controller层（表现层）
- 负责接收HTTP请求
- 参数校验和转换
- 调用Service层处理业务逻辑
- 统一响应格式封装
- 主要Controller：
  - [AuthController](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/controller/auth/AuthController.java)：认证相关接口
  - [DashboardController](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/controller/user/DashboardController.java)：学生仪表盘
  - [ClubController](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/controller/user/ClubController.java)：社团管理
  - [ActivityController](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/controller/user/ActivityController.java)：活动管理
  - [ClubAdminController](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/controller/clubadmin/ClubAdminController.java)：社团管理员
  - [SchoolAdminClubController](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/controller/admin/SchoolAdminClubController.java)：学校管理员

#### 2.2.2 Service层（业务逻辑层）
- 实现核心业务逻辑
- 事务管理
- 数据转换和校验
- 主要Service：
  - [AuthService](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/service/auth/AuthService.java)：认证服务
  - [DashboardService](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/service/user/DashboardService.java)：仪表盘服务
  - [ClubService](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/service/user/ClubService.java)：社团服务
  - [ActivityService](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/service/user/ActivityService.java)：活动服务
  - [ClubManagementService](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/service/admin/ClubManagementService.java)：社团管理服务
  - [StatisticsService](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/service/admin/StatisticsService.java)：统计服务

#### 2.2.3 Repository层（数据访问层）
- 封装数据库访问
- 提供CRUD操作
- 支持自定义查询
- 主要Repository：
  - [StudentRepository](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/repository/StudentRepository.java)
  - [ClubRepository](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/repository/ClubRepository.java)
  - [ActivityRepository](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/repository/ActivityRepository.java)
  - [ClubMemberRepository](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/repository/ClubMemberRepository.java)
  - [ActivityRegistrationRepository](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/repository/ActivityRegistrationRepository.java)

#### 2.2.4 Entity层（实体层）
- 数据库表映射
- 定义实体关系
- 主要Entity：
  - [Student](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/entity/Student.java)：学生实体
  - [Club](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/entity/Club.java)：社团实体
  - [Activity](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/entity/Activity.java)：活动实体
  - [ClubMember](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/entity/ClubMember.java)：社团成员实体
  - [ActivityRegistration](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/entity/ActivityRegistration.java)：活动报名实体

### 2.3 安全架构

```
┌─────────────────────────────────────────────────────────────┐
│                     客户端请求                                │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌────────────────────────────────────────────────────────────┐
│              Spring Security Filter Chain                  │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  1. CorsFilter (跨域处理)                             │  │
│  └──────────────────────────────────────────────────────┘  │
│                          ↓                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  2. JwtAuthenticationFilter (JWT认证过滤器)           │  │
│  │     - 提取Token                                      │  │
│  │     - 验证Token有效性                                 │  │
│  │     - 检查Token黑名单                                 │  │
│  │     - 解析用户信息并设置到SecurityContext               │  │
│  └──────────────────────────────────────────────────────┘  │
│                          ↓                                 │ 
│  ┌──────────────────────────────────────────────────────┐  │
│  │  3. AuthorizationFilter (权限校验)                    │  │
│  │     - 检查用户角色                                     │  │
│  │     - 验证访问权限                                     │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                   Controller层                              │
└─────────────────────────────────────────────────────────────┘
```

**安全配置**: [SecurityConfig](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/security/SecurityConfig.java)

**认证流程**:
1. 用户登录获取JWT Token
2. 后续请求携带Token在Authorization头
3. JwtAuthenticationFilter拦截并验证Token
4. 验证通过后将用户信息存入SecurityContext
5. Controller从SecurityContext获取用户信息

---

## 3. 部署架构设计

### 3.1 开发环境部署

```
┌─────────────────────────────────────────────────────────────┐
│                    开发环境                                  │
│                                                             │
│  ┌──────────────┐    ┌──────────────┐                       │
│  │   开发机     │    │   MySQL数据库  │                       │
│  │              │    │   (localhost) │                      │
│  │  Spring Boot │◄──►│   Port: 3306  │                      │
│  │  Port: 8080  │    │              │                       │
│  └──────────────┘    └──────────────┘                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 生产环境部署

```
┌─────────────────────────────────────────────────────────────┐
│                    生产环境                                  │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                    用户层                             │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐            │   │
│  │  │  学生端  │  │社团管理员│  │学校管理员│                │   │
│  │  └──────────┘  └──────────┘  └──────────┘            │   │
│  └──────────────────────────────────────────────────────┘   │
│                           ↓ HTTPS                           │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                  负载均衡层                            │   │
│  │              Nginx / ALB / SLB                       │   │
│  └──────────────────────────────────────────────────────┘   │
│                           ↓                                 │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                  应用服务器集群                       │    │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐     │   │
│  │  │  App-01    │  │  App-02    │  │  App-03    │     │   │
│  │  │  Port:8080 │  │  Port:8080 │  │  Port:8080 │     │   │
│  │  └────────────┘  └────────────┘  └────────────┘     │   │
│  └─────────────────────────────────────────────────────┘   │
│                           ↓                                │
│  ┌───────────────────────────────────────────────────┐     │
│  │                  数据库层                          │     │
│  │  ┌──────────────────────────────────────────────┐ │     │
│  │  │          MySQL 主从集群                       │  │    │
│  │  │  ┌──────────┐        ┌──────────┐            │  │    │
│  │  │  │ Master   │◄──────►│  Slave   │            │  │    │
│  │  │  │ (写)     │  复制   │  (读)    │            │  │    │
│  │  │  └──────────┘        └──────────┘            │  │    │
│  │  └──────────────────────────────────────────────┘  │    │
│  └────────────────────────────────────────────────────┘    │
└────────────────────────────────────────────────────────────┘
```

### 3.3 部署说明

#### 3.3.1 应用部署
- **容器化部署**: 使用Docker容器打包应用
- **编排工具**: Kubernetes (K8s) 或 Docker Compose
- **配置管理**: 使用环境变量或配置中心
- **日志管理**: ELK Stack (Elasticsearch + Logstash + Kibana)
- **监控告警**: Prometheus + Grafana

#### 3.3.2 数据库部署
- **主从复制**: 一主多从架构，读写分离
- **备份策略**: 定期全量备份 + 增量备份
- **高可用**: MySQL Group Replication 或 MHA

#### 3.3.3 网络配置
- **HTTPS**: 使用SSL证书加密传输
- **防火墙**: 配置安全组规则
- **CDN**: 静态资源加速

---

## 4. 功能模块设计

### 4.1 模块划分

```
学校社团管理平台后端系统
│
├── 1. 认证授权模块 (Auth)
│   ├── 学生登录/注册
│   ├── 社团管理员登录
│   ├── 学校管理员登录
│   └── 退出登录 (Token黑名单)
│
├── 2. 学生端模块 (Student)
│   ├── 2.1 仪表盘模块
│   │   ├── 个人信息展示
│   │   ├── 最近活动
│   │   ├── 我的社团
│   │   └── 统计数据
│   │
│   ├── 2.2 社团管理模块
│   │   ├── 社团列表浏览
│   │   ├── 社团详情查看
│   │   ├── 申请加入社团
│   │   ├── 我的社团列表
│   │   └── 退出社团
│   │
│   ├── 2.3 活动管理模块
│   │   ├── 活动列表浏览
│   │   ├── 活动详情查看
│   │   ├── 活动报名
│   │   ├── 取消报名
│   │   └── 我的活动列表
│   │
│   ├── 2.4 个人信息模块
│   │   ├── 查看个人信息
│   │   ├── 更新个人信息
│   │   ├── 修改密码
│   │   └── 上传头像
│   │
│   └── 2.5 帮助支持模块
│       ├── 常见问题(FAQ)
│       ├── 帮助文档
│       └── 用户反馈
│
├── 3. 社团管理员模块 (ClubAdmin)
│   ├── 3.1 管理概览模块
│   │   ├── 社团基本信息
│   │   ├── 成员统计
│   │   ├── 活动统计
│   │   ├── 待处理申请
│   │   └── 最近动态
│   │
│   ├── 3.2 成员管理模块
│   │   ├── 成员列表查询
│   │   ├── 成员信息查看
│   │   ├── 修改成员角色
│   │   └── 移除社团成员
│   │
│   ├── 3.3 申请管理模块
│   │   ├── 社团申请列表
│   │   ├── 申请详情查看
│   │   ├── 审批申请(通过/拒绝)
│   │   └── 申请记录查询
│   │
│   └── 3.4 活动管理模块
│       ├── 活动列表查询
│       ├── 创建活动
│       ├── 编辑活动
│       ├── 删除活动
│       ├── 活动报名管理
│       └── 签到管理
│
└── 4. 学校管理员模块 (SchoolAdmin)
    ├── 4.1 社团管理模块
    │   ├── 社团列表查询
    │   ├── 创建/编辑社团
    │   ├── 社团状态管理
    │   ├── 社团分类管理
    │   └── 社团统计报表
    │
    ├── 4.2 活动管理模块
    │   ├── 活动列表查询
    │   ├── 活动审批
    │   ├── 活动分类管理
    │   └── 活动统计分析
    │
    ├── 4.3 用户管理模块
    │   ├── 学生列表查询
    │   ├── 学生状态管理
    │   ├── 社团管理员管理
    │   └── 管理员权限配置
    │
    └── 4.4 统计分析模块
        ├── 社团活跃度统计
        ├── 学生活动参与统计
        ├── 活动参与率统计
        └── 数据可视化报表
```

### 4.2 核心功能说明

#### 4.2.1 认证授权模块
- **功能描述**: 提供多角色登录认证和权限管理
- **技术实现**: JWT Token + Spring Security
- **主要接口**:
  - POST `/api/v1/auth/student/login` - 学生登录
  - POST `/api/v1/auth/student/register` - 学生注册
  - POST `/api/v1/auth/club-admin/login` - 社团管理员登录
  - POST `/api/v1/auth/school-admin/login` - 学校管理员登录
  - POST `/api/v1/auth/logout` - 退出登录

#### 4.2.2 学生端模块
- **功能描述**: 学生用户的功能模块，包括社团浏览、活动参与、个人信息管理等
- **主要接口**:
  - GET `/api/v1/student/dashboard` - 获取仪表盘数据
  - GET `/api/v1/student/clubs` - 获取社团列表
  - GET `/api/v1/student/clubs/{club_id}` - 获取社团详情
  - POST `/api/v1/student/clubs/{clubId}/applications` - 申请加入社团
  - GET `/api/v1/student/my-clubs` - 获取我的社团
  - DELETE `/api/v1/student/clubs/{club_id}/leave` - 退出社团
  - GET `/api/v1/student/activities` - 获取活动列表
  - GET `/api/v1/student/activities/{activity_id}` - 获取活动详情
  - POST `/api/v1/student/{activityId}/register` - 活动报名
  - DELETE `/api/v1/student/{activityId}/cancel` - 取消报名
  - GET `/api/v1/student/my-activities` - 获取我的活动
  - GET `/api/v1/student/profile` - 获取个人信息
  - POST `/api/v1/student/profile` - 更新个人信息
  - PUT `/api/v1/student/change-password` - 修改密码
  - GET `/api/v1/student/faqs` - 获取常见问题
  - GET `/api/v1/student/documents` - 获取帮助文档

#### 4.2.3 社团管理员模块
- **功能描述**: 社团管理员对社团、成员、活动进行管理
- **主要接口**:
  - GET `/api/v1/club-admin/dashboard` - 获取管理概览
  - GET `/api/v1/club-admin/members` - 获取成员列表
  - PUT `/api/v1/club-admin/members/{id}/role` - 修改成员角色
  - DELETE `/api/v1/club-admin/members/{id}` - 移除成员
  - GET `/api/v1/club-admin/applications` - 获取申请列表
  - GET `/api/v1/club-admin/applications/{application_id}` - 获取申请详情
  - PUT `/api/v1/club-admin/applications/{application_id}/review` - 审批申请
  - GET `/api/v1/club-admin/activities` - 获取活动列表
  - POST `/api/v1/club-admin/activities` - 创建活动
  - GET `/api/v1/club-admin/activities/{activity_id}` - 获取活动详情
  - PUT `/api/v1/club-admin/activities/{activity_id}` - 更新活动
  - DELETE `/api/v1/club-admin/activities/{activity_id}` - 删除活动

#### 4.2.4 学校管理员模块
- **功能描述**: 学校管理员对全校社团、活动、用户进行统一管理
- **主要接口**:
  - GET `/api/v1/school-admin/clubs` - 获取社团列表
  - POST `/api/v1/school-admin/clubs` - 创建/更新社团
  - PUT `/api/v1/school-admin/clubs/{club_id}/status` - 更新社团状态
  - GET `/api/v1/school-admin/club-categories` - 获取社团分类
  - POST `/api/v1/school-admin/club-categories` - 创建/更新分类
  - GET `/api/v1/school-admin/activities` - 获取活动列表
  - PUT `/api/v1/school-admin/activities/{activity_id}/approve` - 审批活动
  - GET `/api/v1/school-admin/students` - 获取学生列表
  - PUT `/api/v1/school-admin/students/{student_id}/status` - 更新学生状态
  - GET `/api/v1/school-admin/club-admins` - 获取社团管理员列表
  - POST `/api/v1/school-admin/club-admins` - 创建社团管理员
  - GET `/api/v1/school-admin/statistics/club-activity` - 社团活跃度统计
  - GET `/api/v1/school-admin/statistics/student-activity` - 学生活动统计
  - GET `/api/v1/school-admin/statistics/activity-participation` - 活动参与率统计

---

## 5. 数据库设计

### 5.1 数据库表结构

#### 5.1.1 用户相关表

**1. students (学生表)**
```sql
CREATE TABLE students (
    student_id VARCHAR(20) PRIMARY KEY COMMENT '学号',
    name VARCHAR(50) NOT NULL COMMENT '姓名',
    password VARCHAR(255) NOT NULL COMMENT '密码',
    email VARCHAR(100) UNIQUE COMMENT '邮箱',
    phone VARCHAR(20) COMMENT '手机号',
    major VARCHAR(100) COMMENT '专业',
    grade VARCHAR(20) COMMENT '年级',
    enrollment_year INT COMMENT '入学年份',
    gender VARCHAR(10) COMMENT '性别',
    avatar_url VARCHAR(255) COMMENT '头像URL',
    status INT NOT NULL COMMENT '状态: 0-禁用, 1-启用',
    created_at DATETIME NOT NULL COMMENT '创建时间',
    updated_at DATETIME NOT NULL COMMENT '更新时间'
) COMMENT='学生表';
```

**2. school_admins (学校管理员表)**
```sql
CREATE TABLE school_admins (
    admin_id VARCHAR(20) PRIMARY KEY COMMENT '管理员ID',
    name VARCHAR(50) NOT NULL COMMENT '姓名',
    username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户名',
    password VARCHAR(255) NOT NULL COMMENT '密码',
    email VARCHAR(100) UNIQUE COMMENT '邮箱',
    phone VARCHAR(20) COMMENT '手机号',
    avatar_url VARCHAR(255) COMMENT '头像URL',
    role VARCHAR(20) COMMENT '角色',
    status INT NOT NULL COMMENT '状态: 0-禁用, 1-启用',
    created_at DATETIME NOT NULL COMMENT '创建时间',
    updated_at DATETIME NOT NULL COMMENT '更新时间'
) COMMENT='学校管理员表';
```

**3. club_admins (社团管理员表)**
```sql
CREATE TABLE club_admins (
    admin_id VARCHAR(20) PRIMARY KEY COMMENT '管理员ID',
    club_id INT NOT NULL COMMENT '社团ID',
    name VARCHAR(50) NOT NULL COMMENT '姓名',
    username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户名',
    password VARCHAR(255) NOT NULL COMMENT '密码',
    email VARCHAR(100) UNIQUE COMMENT '邮箱',
    phone VARCHAR(20) COMMENT '手机号',
    avatar_url VARCHAR(255) COMMENT '头像URL',
    status INT NOT NULL COMMENT '状态: 0-禁用, 1-启用',
    created_at DATETIME NOT NULL COMMENT '创建时间',
    updated_at DATETIME NOT NULL COMMENT '更新时间',
    FOREIGN KEY (club_id) REFERENCES clubs(club_id)
) COMMENT='社团管理员表';
```

#### 5.1.2 社团相关表

**4. clubs (社团表)**
```sql
CREATE TABLE clubs (
    club_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '社团ID',
    category_id INT COMMENT '分类ID',
    name VARCHAR(100) COMMENT '社团名称',
    description TEXT COMMENT '社团描述',
    logo_url VARCHAR(255) COMMENT '社团Logo',
    president_student_id VARCHAR(20) COMMENT '社长学号',
    foundation_date DATE COMMENT '成立日期',
    member_count INT COMMENT '成员数量',
    max_members INT COMMENT '最大成员数',
    contact_info VARCHAR(255) COMMENT '联系方式',
    meeting_time VARCHAR(100) COMMENT '活动时间',
    meeting_location VARCHAR(255) COMMENT '活动地点',
    status INT COMMENT '状态: 0-禁用, 1-启用',
    FOREIGN KEY (category_id) REFERENCES club_categories(category_id),
    FOREIGN KEY (president_student_id) REFERENCES students(student_id)
) COMMENT='社团表';
```

**5. club_categories (社团分类表)**
```sql
CREATE TABLE club_categories (
    category_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '分类ID',
    name VARCHAR(50) UNIQUE NOT NULL COMMENT '分类名称',
    description TEXT COMMENT '分类描述',
    created_at DATETIME COMMENT '创建时间'
) COMMENT='社团分类表';
```

**6. club_members (社团成员表)**
```sql
CREATE TABLE club_members (
    id INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
    club_id INT NOT NULL COMMENT '社团ID',
    student_id VARCHAR(20) NOT NULL COMMENT '学生学号',
    join_date DATE COMMENT '加入日期',
    role VARCHAR(50) COMMENT '角色: 社长/副社长/普通成员',
    status INT COMMENT '状态: 0-退出, 1-在任',
    FOREIGN KEY (club_id) REFERENCES clubs(club_id),
    FOREIGN KEY (student_id) REFERENCES students(student_id),
    UNIQUE KEY uk_club_student (club_id, student_id)
) COMMENT='社团成员表';
```

**7. club_applications (社团申请表)**
```sql
CREATE TABLE club_applications (
    application_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '申请ID',
    student_id VARCHAR(20) NOT NULL COMMENT '学生学号',
    club_id INT NOT NULL COMMENT '社团ID',
    name VARCHAR(50) NOT NULL COMMENT '姓名',
    major VARCHAR(100) COMMENT '专业',
    grade VARCHAR(20) COMMENT '年级',
    phone VARCHAR(20) COMMENT '手机号',
    email VARCHAR(100) COMMENT '邮箱',
    reason TEXT COMMENT '申请理由',
    experience TEXT COMMENT '相关经验',
    activity_preference TEXT COMMENT '活动偏好',
    available_time TEXT COMMENT '可用时间',
    portfolio VARCHAR(255) COMMENT '作品集链接',
    status VARCHAR(20) COMMENT '状态: 待审核/通过/拒绝',
    reviewed_by VARCHAR(20) COMMENT '审核人ID',
    reviewed_at TIMESTAMP COMMENT '审核时间',
    created_at TIMESTAMP COMMENT '申请时间',
    FOREIGN KEY (student_id) REFERENCES students(student_id),
    FOREIGN KEY (club_id) REFERENCES clubs(club_id),
    FOREIGN KEY (reviewed_by) REFERENCES club_admins(admin_id)
) COMMENT='社团申请表';
```

#### 5.1.3 活动相关表

**8. activities (活动表)**
```sql
CREATE TABLE activities (
    activity_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '活动ID',
    club_id INT NOT NULL COMMENT '社团ID',
    category_id INT COMMENT '分类ID',
    title VARCHAR(200) COMMENT '活动标题',
    description TEXT COMMENT '活动描述',
    poster_url VARCHAR(255) COMMENT '海报URL',
    location VARCHAR(255) COMMENT '活动地点',
    start_time DATETIME COMMENT '开始时间',
    end_time DATETIME COMMENT '结束时间',
    points DOUBLE COMMENT '活动积分',
    status VARCHAR(20) COMMENT '状态: 待审批/已批准/已拒绝/进行中/已结束',
    max_participants INT COMMENT '最大参与人数',
    registered_count INT COMMENT '已报名人数',
    registration_deadline DATETIME COMMENT '报名截止时间',
    created_by VARCHAR(20) COMMENT '创建人ID',
    created_at DATETIME COMMENT '创建时间',
    updated_at DATETIME COMMENT '更新时间',
    approved_by VARCHAR(20) COMMENT '审批人ID',
    approved_at DATETIME COMMENT '审批时间',
    FOREIGN KEY (club_id) REFERENCES clubs(club_id),
    FOREIGN KEY (category_id) REFERENCES activity_categories(category_id)
) COMMENT='活动表';
```

**9. activity_categories (活动分类表)**
```sql
CREATE TABLE activity_categories (
    category_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '分类ID',
    name VARCHAR(50) UNIQUE NOT NULL COMMENT '分类名称',
    description TEXT COMMENT '分类描述',
    created_at DATETIME COMMENT '创建时间'
) COMMENT='活动分类表';
```

**10. activity_registrations (活动报名表)**
```sql
CREATE TABLE activity_registrations (
    registration_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '报名ID',
    activity_id INT NOT NULL COMMENT '活动ID',
    student_id VARCHAR(20) NOT NULL COMMENT '学生学号',
    registration_time DATETIME COMMENT '报名时间',
    status VARCHAR(20) COMMENT '状态: 已报名/已取消/已完成',
    attended INT COMMENT '是否签到: 0-未签到, 1-已签到',
    points_earned DOUBLE COMMENT '获得积分',
    FOREIGN KEY (activity_id) REFERENCES activities(activity_id),
    FOREIGN KEY (student_id) REFERENCES students(student_id),
    UNIQUE KEY uk_activity_student (activity_id, student_id)
) COMMENT='活动报名表';
```

**11. activity_approvals (活动审批表)**
```sql
CREATE TABLE activity_approvals (
    approval_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '审批ID',
    activity_id INT NOT NULL COMMENT '活动ID',
    approver_id VARCHAR(20) NOT NULL COMMENT '审批人ID',
    status VARCHAR(20) NOT NULL COMMENT '状态: 待审批/已批准/已拒绝',
    comments TEXT COMMENT '审批意见',
    approved_at DATETIME COMMENT '审批时间',
    created_at DATETIME COMMENT '创建时间',
    FOREIGN KEY (activity_id) REFERENCES activities(activity_id),
    FOREIGN KEY (approver_id) REFERENCES school_admins(admin_id)
) COMMENT='活动审批表';
```

#### 5.1.4 积分相关表

**12. student_points (学生积分表)**
```sql
CREATE TABLE student_points (
    point_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '积分ID',
    student_id VARCHAR(20) NOT NULL COMMENT '学生学号',
    activity_id INT COMMENT '活动ID',
    points DOUBLE COMMENT '积分值',
    reason VARCHAR(255) COMMENT '积分原因',
    awarded_at DATETIME COMMENT '发放时间',
    created_at DATETIME COMMENT '创建时间',
    FOREIGN KEY (student_id) REFERENCES students(student_id),
    FOREIGN KEY (activity_id) REFERENCES activities(activity_id)
) COMMENT='学生积分表';
```

#### 5.1.5 帮助支持表

**13. faqs (常见问题表)**
```sql
CREATE TABLE faqs (
    faq_id INT AUTO_INCREMENT PRIMARY KEY COMMENT 'FAQ ID',
    question TEXT NOT NULL COMMENT '问题',
    answer TEXT NOT NULL COMMENT '答案',
    category VARCHAR(50) COMMENT '分类',
    created_at DATETIME COMMENT '创建时间',
    updated_at DATETIME COMMENT '更新时间',
    status INT NOT NULL COMMENT '状态: 0-禁用, 1-启用'
) COMMENT='常见问题表';
```

**14. help_documents (帮助文档表)**
```sql
CREATE TABLE help_documents (
    document_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '文档ID',
    title VARCHAR(100) NOT NULL COMMENT '文档标题',
    content TEXT NOT NULL COMMENT '文档内容',
    category VARCHAR(50) COMMENT '分类',
    author_id VARCHAR(20) COMMENT '作者ID',
    created_at DATETIME COMMENT '创建时间',
    updated_at DATETIME COMMENT '更新时间',
    status INT NOT NULL COMMENT '状态: 0-禁用, 1-启用',
    FOREIGN KEY (author_id) REFERENCES school_admins(admin_id)
) COMMENT='帮助文档表';
```

### 5.2 ER图

```
┌─────────────┐         ┌─────────────┐         ┌─────────────┐
│  students   │         │  clubs      │         │activities   │
├─────────────┤         ├─────────────┤         ├─────────────┤
│ student_id  │◄────────│ club_id     │◄────────│ activity_id │
│ name        │ 1      N│ category_id │ 1      N│ club_id     │
│ email       │         │ name        │         │ title       │
│ password    │         │ member_count│         │ status      │
│ status      │         │ status      │         │ start_time  │
└──────┬──────┘         └──────┬──────┘         └──────┬──────┘
       │                       │                       │
       │                       │                       │
       │ N              1      │              1        │ N
       │                       │                       │
┌──────▼──────┐         ┌──────▼──────┐         ┌──────▼──────┐
│club_members │         │club_applica-│         │activity_reg-│
├─────────────┤         │tions       │         │istrations   │
│ id          │         ├─────────────┤         ├─────────────┤
│ club_id     │         │application_│         │registration_│
│ student_id  │         │id          │         │id           │
│ role        │         │student_id  │         │activity_id  │
│ status      │         │club_id     │         │student_id   │
└─────────────┘         │status      │         │status       │
                        └─────────────┘         └─────────────┘

┌─────────────┐         ┌─────────────┐         ┌─────────────┐
│school_admins│         │club_admins  │         │student_     │
├─────────────┤         ├─────────────┤         │points       │
│ admin_id    │         │ admin_id    │         ├─────────────┤
│ name        │         │ club_id     │         │ point_id    │
│ username    │         │ name        │         │ student_id  │
│ password    │         │ username    │         │ activity_id │
│ status      │         │ password    │         │ points      │
└─────────────┘         │ status      │         └─────────────┘
                        └─────────────┘

┌─────────────┐         ┌─────────────┐
│club_catego- │         │activity_    │
│ries         │         │categories   │
├─────────────┤         ├─────────────┤
│category_id  │         │category_id  │
│name         │         │name         │
│description  │         │description  │
└─────────────┘         └─────────────┘

┌─────────────┐         ┌─────────────┐
│faqs         │         │help_        │
│             │         │documents    │
├─────────────┤         ├─────────────┤
│faq_id       │         │document_id  │
│question     │         │title        │
│answer       │         │content      │
│category     │         │category     │
│status       │         │status       │
└─────────────┘         └─────────────┘
```

### 5.3 索引设计

**主要索引**:
- `students`: PRIMARY KEY (student_id), UNIQUE INDEX (email)
- `school_admins`: PRIMARY KEY (admin_id), UNIQUE INDEX (username), UNIQUE INDEX (email)
- `club_admins`: PRIMARY KEY (admin_id), UNIQUE INDEX (username), UNIQUE INDEX (email), INDEX (club_id)
- `clubs`: PRIMARY KEY (club_id), INDEX (category_id), INDEX (status)
- `club_categories`: PRIMARY KEY (category_id), UNIQUE INDEX (name)
- `club_members`: PRIMARY KEY (id), UNIQUE INDEX (club_id, student_id), INDEX (student_id)
- `club_applications`: PRIMARY KEY (application_id), INDEX (club_id), INDEX (student_id), INDEX (status)
- `activities`: PRIMARY KEY (activity_id), INDEX (club_id), INDEX (category_id), INDEX (status), INDEX (start_time)
- `activity_categories`: PRIMARY KEY (category_id), UNIQUE INDEX (name)
- `activity_registrations`: PRIMARY KEY (registration_id), UNIQUE INDEX (activity_id, student_id), INDEX (student_id)
- `activity_approvals`: PRIMARY KEY (approval_id), INDEX (activity_id), INDEX (approver_id)
- `student_points`: PRIMARY KEY (point_id), INDEX (student_id), INDEX (activity_id)
- `faqs`: PRIMARY KEY (faq_id), INDEX (category), INDEX (status)
- `help_documents`: PRIMARY KEY (document_id), INDEX (category), INDEX (status)

---

## 6. 接口设计规范

### 6.1 RESTful API设计原则

- 使用HTTP动词表示操作类型：GET(查询)、POST(创建)、PUT(更新)、DELETE(删除)
- 使用名词表示资源：/students, /clubs, /activities
- 使用路径参数标识资源：/clubs/{club_id}
- 使用查询参数进行过滤和分页：?page=1&page_size=10&status=1
- 统一响应格式：{code, message, data}

### 6.2 统一响应格式

```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

**状态码说明**:
- 200: 请求成功
- 400: 请求参数错误
- 401: 未授权或token过期
- 403: 权限不足
- 404: 资源不存在
- 500: 服务器内部错误

### 6.3 认证方式

使用JWT (JSON Web Token) 进行身份认证：

**请求头格式**:
```
Authorization: Bearer {token}
```

**Token结构**:
```json
{
  "user_id": "2021001",
  "role": "student",
  "exp": 1234567890
}
```

---

## 7. 异常处理

### 7.1 异常分类

- **BusinessException**: 业务异常
- **AuthenticationException**: 认证异常
- **AuthorizationException**: 授权异常
- **ValidationException**: 参数校验异常
- **SystemException**: 系统异常

### 7.2 全局异常处理

使用 [GlobalExceptionHandler](file:///c:/Users/ASUS/Desktop/smart learning platform/学校社团管理平台后端部分（作为第7组的开发组）/demo/src/main/java/com/example/demo/common/GlobalExceptionHandler.java) 统一处理异常，返回标准错误响应。

---

## 8. 性能优化建议

### 8.1 数据库优化
- 合理使用索引
- 避免N+1查询问题
- 使用分页查询
- 读写分离

### 8.2 应用优化
- 使用缓存（Redis）
- 异步处理耗时操作
- 数据库连接池配置
- JVM参数调优

### 8.3 接口优化
- 接口响应压缩
- CDN加速静态资源
- 接口限流和熔断

---

## 9. 安全设计

### 9.1 认证安全
- 密码BCrypt加密存储
- JWT Token有效期控制
- Token黑名单机制
- 登录失败限制

### 9.2 接口安全
- HTTPS加密传输
- CORS跨域配置
- SQL注入防护
- XSS攻击防护

### 9.3 数据安全
- 敏感数据加密
- 数据备份策略
- 操作日志记录
- 权限最小化原则

---

## 10. 扩展性设计

### 10.1 水平扩展
- 无状态服务设计
- 负载均衡支持
- 分布式Session

### 10.2 功能扩展
- 模块化设计
- 插件化架构
- 微服务化改造

---

## 11. 总结

本概要设计文档详细描述了学校社团管理平台后端系统的架构设计、部署方案、功能模块和数据库设计。系统采用分层架构，基于Spring Boot框架，使用JWT进行认证，MySQL作为数据存储，支持学生、社团管理员、学校管理员三种角色的协同管理。

系统具有良好的可扩展性、安全性和可维护性，能够满足高校社团管理的业务需求。
